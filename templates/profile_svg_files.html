<!DOCTYPE html>
<html lang="vi" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Qu·∫£n l√Ω v√† xem c√°c file SVG ƒë√£ t·∫°o t·ª´ TikZ code">
    <meta name="keywords" content="TikZ, SVG, LaTeX, vector graphics, profile">
    <meta name="author" content="TikZ to SVG">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="File SVG c·ªßa t√¥i - TikZ to SVG">
    <meta property="og:description" content="Qu·∫£n l√Ω v√† xem c√°c file SVG ƒë√£ t·∫°o t·ª´ TikZ code">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="vi_VN">
    <title>File SVG c·ªßa t√¥i - TikZ to SVG</title>
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='favicon-16x16.png') }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicon-32x32.png') }}">
    <link rel="icon" type="image/png" sizes="48x48" href="{{ url_for('static', filename='favicon-48x48.png') }}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='apple-touch-icon.png') }}">
    <link rel="icon" type="image/png" sizes="192x192" href="{{ url_for('static', filename='android-chrome-192x192.png') }}">
    <link rel="icon" type="image/png" sizes="512x512" href="{{ url_for('static', filename='android-chrome-512x512.png') }}">
    <link rel="shortcut icon" type="image/png" href="{{ url_for('static', filename='favicon-32x32.png') }}">
    
    <!-- Global state (JSON to satisfy linter) -->
    <script id="app-state" type="application/json">{{ {
        'isLoggedIn': (True if current_user.is_authenticated else False),
        'isOwner': (True if is_owner else False)
    } | tojson | safe }}</script>
    <script>
        (function(){
            try {
                var state = JSON.parse(document.getElementById('app-state').textContent);
                window.isLoggedIn = !!state.isLoggedIn;
                window.isOwner = !!state.isOwner;
            } catch (e) {
                window.isLoggedIn = false;
                window.isOwner = false;
            }
            window.activeFeedbackCount = 0;
        })();
    </script>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <!-- Navigation CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/navigation.css', v='1.0') }}">
    
    <!-- Page-specific CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/profile_svg_files.css', v='1.0') }}">
    
    <!-- CodeMirror CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/material.min.css">

</head>
<body>
    {% include '_navbar.html' %}

    <div class="container">
        <!-- Public Profile Header -->
        <div class="public-profile-header">
            <div class="profile-info">
                {% if avatar %}
                    <img src="{{ url_for('static', filename='avatars/' ~ avatar) }}" alt="Avatar" class="profile-avatar">
                {% else %}
                    <div class="profile-avatar-placeholder">
                        {{ user_email[0].upper() if user_email else 'U' }}
                    </div>
                {% endif %}
                
                <h2 class="profile-name">{{ username or user_email.split('@')[0] }}</h2>
                
                <div class="profile-stats">
                    <span class="separator">|</span>
                    <span>üë• {{ follower_count }} followers</span>
                </div>
            </div>
            
            {% if bio %}
                <div class="bio-container profile-bio">
                    {{ bio | safe }}
                </div>
            {% endif %}
            
            <div class="profile-email">
                <strong>Email li√™n h·ªá:</strong> {{ user_email }}
            </div>
            
            {% if current_user.is_authenticated and not is_owner %}
                <div class="profile-actions">
                    {% if is_followed %}
                        <button type="button" class="btn btn-secondary follow-btn" data-user-id="{{ user_id }}">
                            üë• B·ªè theo d√µi
                        </button>
                    {% else %}
                        {% if current_identity_verified %}
                            <button type="button" class="btn btn-primary follow-btn" data-user-id="{{ user_id }}">
                                üë• Theo d√µi
                            </button>
                        {% else %}
                            <div class="verification-notice">
                                <button type="button" class="btn btn-secondary follow-btn" disabled>
                                    üë• Theo d√µi (c·∫ßn x√°c th·ª±c)
                                </button>
                                <small class="verification-badge">
                                    üîê Vui l√≤ng <a href="{{ url_for('profile_verification') }}">x√°c th·ª±c danh t√≠nh</a> ƒë·ªÉ s·ª≠ d·ª•ng t√≠nh nƒÉng theo d√µi
                                </small>
                            </div>
                        {% endif %}
                    {% endif %}
                </div>
            {% endif %}
        </div>

        <section class="svg-files-section">
            <h3>
                {% if is_owner %}
                    üìÇ C√°c file SVG b·∫°n ƒë√£ t·∫°o
                {% else %}
                    üìÇ Danh s√°ch c√°c file SVG ƒë√£ t·∫°o
                {% endif %}
            </h3>
            {% if svg_files %}
            <div class="files-grid">
                {% for file in svg_files %}
                <div class="file-card" data-id="{{ file.id }}">
                  <button class="action-toggle-btn" type="button" aria-label="Hi·ªán menu h√†nh ƒë·ªông">‚ãØ</button>
                  <div class="file-img-container">
                    <img src="{{ file.url }}" alt="{{ file.filename }}">
                    <!-- N√∫t Like m·ªõi - ch·ªâ hi·ªÉn th·ªã khi ƒë√£ ƒëƒÉng nh·∫≠p -->
                    {% if current_user.is_authenticated %}
                    <div class="like-button-wrapper">
                      <div class="like-button">
                        <input id="heart-{{ file.id }}" type="checkbox" {% if file.is_liked_by_current_user %}checked{% endif %} />
                        <label class="like" for="heart-{{ file.id }}">
                          <svg
                            class="like-icon"
                            fill-rule="nonzero"
                            viewBox="0 0 24 24"
                            xmlns="http://www.w3.org/2000/svg"
                          >
                            <path
                              d="m11.645 20.91-.007-.003-.022-.012a15.247 15.247 0 0 1-.383-.218 25.18 25.18 0 0 1-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0 1 12 5.052 5.5 5.5 0 0 1 16.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 0 1-4.244 3.17 15.247 15.247 0 0 1-.383.219l-.022.012-.007.004-.003.001a.752.752 0 0 1-.704 0l-.003-.001Z"
                            ></path>
                          </svg>
                          <span class="like-text">Likes</span>
                        </label>
                        <span class="like-count one">{{ file.like_count }}</span>
                        <span class="like-count two">{{ file.like_count }}</span>
                      </div>
                    </div>
                    {% else %}
                    <!-- Hi·ªÉn th·ªã s·ªë like khi ch∆∞a ƒëƒÉng nh·∫≠p -->
                    <div class="like-display">
                      <span class="heart-icon">‚ù§Ô∏è</span>
                      <span class="like-count">{{ file.like_count }}</span>
                    </div>
                    {% endif %}
                  </div>

                  <div class="file-action-container">
                    <ul class="file-action-list">
                      <li class="file-action-item">
                        <button type="button" class="Btn download-btn" data-filename="{{ file.filename }}">
                          <div class="sign">
                            <i class="fas fa-image logoIcon"></i>
                          </div>
                          <div class="text">T·∫£i ·∫£nh</div>
                        </button>
                      </li>
                      <li class="file-action-item">
                        <button type="button" class="Btn fb-share-btn" data-filename="{{ file.filename }}" data-has-feedback="true">
                          <div class="sign">
                            <i class="fab fa-facebook logoIcon"></i>
                          </div>
                          <div class="text">Facebook</div>
                        </button>
                      </li>
                      <li class="file-action-item">
                        <button type="button" class="Btn file-copy-link-btn" data-url="{{ request.host_url.rstrip('/') ~ file.url }}" data-has-feedback="true">
                          <div class="sign">
                            <i class="fas fa-link logoIcon"></i>
                          </div>
                          <div class="text">Copy Link</div>
                        </button>
                      </li>
                      {% if file.tikz_code %}
                      <li class="file-action-item">
                        <button type="button" class="Btn view-code-btn" data-filename="{{ file.filename }}">
                          <div class="sign">
                            <i class="fas fa-code logoIcon"></i>
                          </div>
                          <div class="text">Xem Code</div>
                        </button>
                      </li>
                      {% endif %}
                      <!-- N√∫t x√≥a ch·ªâ hi·ªÉn th·ªã khi user xem profile c·ªßa ch√≠nh m√¨nh -->
                      {% if is_owner %}
                      <li class="file-action-item">
                        <button type="button" class="Btn delete-btn">
                          <div class="sign">
                            <i class="fas fa-trash logoIcon"></i>
                          </div>
                          <div class="text">X√≥a ·∫£nh</div>
                        </button>
                      </li>
                      {% endif %}
                    </ul>
                  </div>
                  

                  <!-- Info Section -->
                  <div class="file-info">
                    <div class="file-meta">
                      <span class="label">T·∫°o l√∫c:</span> {{ file.created_time }}
                    </div>
                    {% if file.size %}
                      <div class="file-meta">
                        <span class="label">K√≠ch th∆∞·ªõc:</span> {{ file.size }} KB
                      </div>
                    {% else %}
                      <div class="file-meta">
                        <span class="label">K√≠ch th∆∞·ªõc:</span> Kh√¥ng x√°c ƒë·ªãnh
                      </div>
                    {% endif %}
                    {% if file.creator_id and file.creator_username %}
                      <div class="file-creator">
                        üë§ <a href="/profile/{{ file.creator_id }}">
                          {{ file.creator_username }}
                        </a>
                      </div>
                    {% endif %}
                  </div>

                  <!-- TikZ Code Section -->
                  {% if file.tikz_code %}
                  <div class="tikz-code-block">
                    <div class="tikz-code-header">
                      <span>Code TikZ:</span>
                      <button class="copy-btn copy-tikz-btn">üìã Copy</button>
                    </div>
                    <div class="code-block">
                      <textarea class="tikz-cm" readonly>{{ file.tikz_code | e }}</textarea>
                    </div>
                  </div>
                  {% endif %}
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">Ch∆∞a c√≥ file SVG n√†o ƒë∆∞·ª£c t·∫°o. H√£y th·ª≠ chuy·ªÉn ƒë·ªïi m·ªôt code TikZ!</div>
            {% endif %}
        </section>
    </div>

    <!-- Modal ƒëƒÉng xu·∫•t ch·ªâ render n·∫øu ƒë√£ login -->
    {% if user_email %}
    <div id="logout-modal" class="modal-overlay">
      <div class="modal-content">
        <h3>ƒêƒÉng xu·∫•t?</h3>
        <a href="/logout" class="btn-logout">ƒêƒÉng xu·∫•t</a>
        <button class="btn-cancel cancel-logout-btn">Hu·ª∑</button>
      </div>
    </div>
    {% endif %}

    <!-- Modal ƒëƒÉng nh·∫≠p cho tr∆∞·ªùng h·ª£p ch∆∞a ƒëƒÉng nh·∫≠p -->
    {% if not current_user.is_authenticated %}
    <div id="login-modal" class="modal-overlay">
      <div class="modal-content">
        <h3>ƒêƒÉng nh·∫≠p ƒë·ªÉ s·ª≠ d·ª•ng t√≠nh nƒÉng n√†y</h3>
        <p>Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ c√≥ th·ªÉ:</p>
        <ul>
          <li>üëç Like v√† unlike ·∫£nh</li>
          <li>üëÅÔ∏è Xem TikZ code</li>
          <li>üóëÔ∏è X√≥a ·∫£nh c·ªßa b·∫°n</li>
          <li>üë• Theo d√µi ng∆∞·ªùi d√πng kh√°c</li>
        </ul>
        <p class="login-note">üí° B·∫°n v·∫´n c√≥ th·ªÉ s·ª≠ d·ª•ng Facebook Share v√† Copy Link m√† kh√¥ng c·∫ßn ƒëƒÉng nh·∫≠p!</p>
        <button class="google-login-btn modal-login-btn">
          <i class="fab fa-google"></i>ƒêƒÉng nh·∫≠p v·ªõi Google
        </button>
        <button class="btn-cancel cancel-login-btn">Hu·ª∑</button>
      </div>
    </div>
    {% endif %}

    <!-- Modal x√°c nh·∫≠n x√≥a ·∫£nh -->
    <div id="delete-confirm-modal" class="modal-overlay delete-modal">
      <div class="modal-content">
        <h3>B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ·∫£nh n√†y?</h3>
        <div class="delete-warning">H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!</div>
        <div class="btn-container">
          <button id="confirm-delete-btn" class="btn btn-primary btn-delete">X√≥a</button>
          <button id="cancel-delete-btn" class="btn btn-secondary">H·ªßy</button>
        </div>
      </div>
    </div>

    <!-- CodeMirror libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/stex/stex.min.js"></script>
    
    <!-- Page-specific JavaScript -->
    <script src="{{ url_for('static', filename='js/profile_svg_files.js', v='1.0') }}"></script>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html> 
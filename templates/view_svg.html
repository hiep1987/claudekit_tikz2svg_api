<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Xem SVG - {{ display_name }}</title>
    <meta property="og:title" content="TikZ to SVG - {{ display_name }}" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="{{ request.host_url.rstrip('/') ~ png_url }}" />
    <meta property="og:url" content="{{ request.host_url.rstrip('/') ~ url_for('view_svg', filename=filename) }}" />
    <meta property="og:description" content="Xem v√† chia s·∫ª h√¨nh TikZ SVG tr·ª±c tuy·∫øn." />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Highlight.js CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <!-- Font Awesome CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css">
    <style>
      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
        transition: all 0.3s ease;
      }
    
      .container {
        max-width: 1000px;
        margin: 30px auto;
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        padding: 32px;
      }
    
      h2 {
        text-align: center;
        color: #1976d2;
        margin-bottom: 24px;
      }
    
      /* Tailwind-like utility classes for navbar */
      .w-full { width: 100%; }
      .max-w-7xl { max-width: 80rem; }
      .mx-auto { margin-left: auto; margin-right: auto; }
      .bg-white\/80 { background-color: rgba(255, 255, 255, 0.8); }
      .backdrop-blur { backdrop-filter: blur(8px); }
      .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
      .rounded-2xl { border-radius: 1rem; }
      .p-3 { padding: 0.75rem; }
      .flex { display: flex; }
      .items-center { align-items: center; }
      .justify-between { justify-content: space-between; }
      .mb-8 { margin-bottom: 2rem; }
      .gap-2 { gap: 0.5rem; }
      .bg-gradient-to-br { background-image: linear-gradient(to bottom right, var(--tw-gradient-stops)); }
      .from-blue-500 { --tw-gradient-from: #3b82f6; --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to, rgba(59, 130, 246, 0)); }
      .to-yellow-400 { --tw-gradient-to: #fbbf24; }
      .p-1\.5 { padding: 0.375rem; }
      .rounded-lg { border-radius: 0.5rem; }
      .text-white { color: #ffffff; }
      .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
      .text-gray-800 { color: #1f2937; }
      .font-bold { font-weight: 700; }
      .hidden { display: none; }
      .gap-6 { gap: 1.5rem; }
      .font-medium { font-weight: 500; }
      .text-gray-700 { color: #374151; }
      .relative { position: relative; }
      .px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
      .py-1 { padding-top: 0.25rem; padding-bottom: 0.25rem; }
      .cursor-pointer { cursor: pointer; }
      .transition { transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 150ms; }
      .hover\:text-blue-600:hover { color: #2563eb; }
      .block { display: block; }
      .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
      .bg-gradient-to-r { background-image: linear-gradient(to right, var(--tw-gradient-stops)); }
      .from-red-400 { --tw-gradient-from: #f87171; --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to, rgba(248, 113, 113, 0)); }
      .to-red-600 { --tw-gradient-to: #dc2626; }
      .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
      .py-1\.5 { padding-top: 0.375rem; padding-bottom: 0.375rem; }
      .rounded-xl { border-radius: 0.75rem; }
      .hover\:scale-105:hover { transform: scale(1.05); }
      .font-semibold { font-weight: 600; }
      .from-blue-400 { --tw-gradient-from: #60a5fa; --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to, rgba(96, 165, 250, 0)); }
      .hover\:bg-blue-100:hover { background-color: #dbeafe; }
      .text-2xl { font-size: 1.5rem; line-height: 2rem; }
      .text-gray-500 { color: #6b7280; }
      .hover\:text-blue-400:hover { color: #60a5fa; }
      .fixed { position: fixed; }
      .top-0 { top: 0px; }
      .left-0 { left: 0px; }
      .h-full { height: 100%; }
      .bg-black\/50 { background-color: rgba(0, 0, 0, 0.5); }
      .absolute { position: absolute; }
      .right-0 { right: 0px; }
      .w-60 { width: 15rem; }
      .bg-white { background-color: #ffffff; }
      .flex-col { flex-direction: column; }
      .p-6 { padding: 1.5rem; }
      .gap-3 { gap: 0.75rem; }
      .self-end { align-self: flex-end; }
      .mt-2 { margin-top: 0.5rem; }
      .text-center { text-align: center; }
      .mt-8 { margin-top: 2rem; }
      .w-6 { width: 1.5rem; }
      .h-6 { height: 1.5rem; }
      .rounded-full { border-radius: 9999px; }
      .to-purple-600 { --tw-gradient-to: #9333ea; }
      .justify-center { justify-content: center; }
      .text-xs { font-size: 0.75rem; line-height: 1rem; }
      .mb-4 { margin-bottom: 1rem; }
      .flex-grow { flex-grow: 1; }
      .mx-4 { margin-left: 1rem; margin-right: 1rem; }
      .overflow-hidden { overflow: hidden; }
      .text-base { font-size: 1rem; line-height: 1.5rem; }
      .flex-shrink-0 { flex-shrink: 0; }
      
      /* Responsive breakpoints */
      @media (min-width: 920px) {
          .md\:flex { display: flex; }
          .md\:block { display: block; }
          .md\:hidden { display: none; }
      }
      
      /* New Navigation Styles */
      .menu-underline {
        transition: all 0.3s cubic-bezier(0.4,0,0.2,1);
        height: 3px;
        width: 0;
        background: linear-gradient(90deg, #fbbf24, #38bdf8);
        border-radius: 2px;
        margin: 0 auto;
        position: absolute;
        bottom: -2px;
        left: 50%;
        transform: translateX(-50%);
      }
      .menu-item:hover .menu-underline, .menu-item.active .menu-underline {
        width: 80%;
      }
      
      /* Override custom CSS for menu items to remove unwanted styling */
      .menu-item {
        list-style: none !important;
      }
      
      .menu-item a {
        text-decoration: none !important;
        color: #374151 !important;
      }
      
      .menu-item:hover a {
        color: #2563eb !important;
      }
      
      /* Remove any bullet points or underlines from menu */
      .hidden.md\:flex {
        list-style: none !important;
        padding: 0 !important;
        margin: 0 !important;
      }
      
      .hidden.md\:flex li {
        list-style: none !important;
      }
      
      .hidden.md\:flex li a {
        text-decoration: none !important;
      }
      
      /* Fix mobile menu styling */
      #mobile-menu a {
        text-decoration: none !important;
        color: #374151 !important;
      }
      
      #mobile-menu a:hover {
        color: #2563eb !important;
      }
      
      /* Mobile scroll for menu */
      #scrollable-menu {
          overflow-x: auto;
          white-space: nowrap;
          -webkit-overflow-scrolling: touch;
          -ms-overflow-style: none;
          scrollbar-width: none;
          padding-bottom: 0.75rem;
      }
      #scrollable-menu::-webkit-scrollbar {
          display: none;
      }
      
      #scrollable-menu-list {
          list-style: none !important;
          padding: 0 !important;
          margin: 0 !important;
      }
      
      #scrollable-menu-list .menu-item {
          flex-shrink: 0;
      }
      
      #main-menu {
          list-style: none !important;
          padding: 0 !important;
          margin: 0 !important;
      }
    
      /* Google Login Button Styles (from index.html) */
      .google-login-btn {
        max-width: 320px;
        display: flex;
        padding: 8px 16px;
        font-size: 14px;
        line-height: 1.25rem;
        font-weight: 700;
        text-align: center;
        text-transform: uppercase;
        align-items: center;
        justify-content: center;
        border-radius: 6px;
        border: 1px solid rgba(0, 0, 0, 0.25);
        gap: 0.75rem;
        color: rgb(65, 63, 63);
        background-color: #fff;
        cursor: pointer;
        transition: all .6s ease;
        min-height: 40px;
        margin: 0 auto;
      }

      .google-login-btn svg {
        height: 24px;
        flex-shrink: 0;
      }

      .google-login-btn:hover {
        transform: scale(1.02);
        background-color: #1565c0;
        color: white;
      }
      
      /* Google login button responsive */
      @media (max-width: 600px) {
        .google-login-btn {
          max-width: 280px;
          padding: 8px 16px;
          font-size: 14px;
          min-height: 40px;
          margin: 0 auto;
        }
        
        .google-login-btn svg {
          height: 20px;
        }
      }
    
      /* View Mode Row Layout */
      #view-mode-row {
        display: flex;
        gap: 32px;
        margin-bottom: 24px;
        flex-wrap: wrap;
      }
    
      .view-col {
        flex: 1 1 300px;
        min-width: 280px;
        box-sizing: border-box;
      }
    
      /* SVG Preview Block */
      #view-svg-preview {
        background: #fff;
        border: 1.5px solid #eee;
        border-radius: 8px;
        padding: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 320px;
        height: 400px;
        width: 100%;
        box-sizing: border-box;
      }
    
      #view-svg-preview img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        display: block;
        margin: 0 auto;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      }
    
      /* Action Buttons below SVG */
      #view-svg-actions {
        margin-top: 16px;
        display: flex;
        gap: 12px;
        justify-content: center;
        flex-wrap: wrap;
      }
    
      #view-svg-actions .view-action-btn {
        background: #ffc107;
        color: #212529;
        padding: 12px 20px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        text-decoration: none;
        box-shadow: 0 2px 8px rgba(255,193,7,0.2);
        transition: all 0.2s;
      }
    
      #view-svg-actions .view-action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(255,193,7,0.3);
      }
    
      #view-svg-actions .view-download-btn {
        background: #17a2b8;
        color: white;
      }
    
      #view-svg-actions .view-download-btn:hover {
        box-shadow: 0 4px 12px rgba(23,162,184,0.3);
      }
    
      /* Back to Edit Button */
      #view-back-to-edit-btn {
        background: linear-gradient(90deg, #28a745 0%, #218838 100%);
        color: white;
        padding: 12px 20px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }
    
      #view-back-to-edit-btn:hover {
        box-shadow: 0 4px 12px rgba(40,167,69,0.3);
        transform: translateY(-2px);
      }
    
      /* Export Section */
      .export-section {
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        padding: 20px;
        margin-top: 24px;
      }
    
      .export-section h4 {
        color: #333;
        text-align: center;
        margin-bottom: 16px;
      }
    
      #view-export-form {
        display: grid;
        grid-template-columns: 1fr;
        gap: 16px;
        align-items: start;
        margin-bottom: 16px;
      }
    
      #view-export-form .export-pair {
        display: flex;
        align-items: center;
        gap: 10px;
      }
    
      #view-export-form .export-label {
        font-weight: 500;
        color: #555;
        min-width: 80px;
        flex-shrink: 0;
      }
    
      .export-input {
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 5px;
        box-sizing: border-box;
      }
    
      .export-select {
        width: 100%;
        min-width: 120px;
        max-width: 180px;
        height: 40px;
        padding: 8px 12px;
        font-size: 16px;
        border-radius: 5px;
        border: 1px solid #ddd;
        background: #f8f9fa;
      }
    
      .export-number {
        width: 100px;
      }
    
      #view-export-form .export-btn-group {
        grid-column: 1 / -1;
        display: flex;
        justify-content: center;
        margin-top: 16px;
      }
    
      #view-export-form .export-btn {
        background: linear-gradient(90deg, #1976d2 0%, #1565c0 100%);
        color: white;
        padding: 12px 20px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        min-width: 140px;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }
    
      #view-export-form .export-btn:hover {
        box-shadow: 0 4px 12px rgba(25, 118, 210, 0.3);
        transform: translateY(-2px);
      }
    
      #view-export-msg {
        text-align: center;
        color: #388e3c;
        font-weight: bold;
        margin-top: 8px;
      }

      #view-export-msg.error {
        color: #d32f2f;
      }

      /* Export Download Link Style */
      .export-download-link {
        display: inline-block;
        background: linear-gradient(90deg, #17a2b8 0%, #138496 100%);
        color: white;
        padding: 12px 20px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        text-decoration: none;
        cursor: pointer;
        transition: all 0.2s;
        box-shadow: 0 2px 8px rgba(23,162,184,0.2);
        margin-top: 8px;
      }

      .export-download-link:hover {
        background: linear-gradient(90deg, #138496 0%, #117a8b 100%);
        box-shadow: 0 4px 12px rgba(23,162,184,0.3);
        transform: translateY(-2px);
        color: white;
        text-decoration: none;
      }
    
      /* Responsive Adjustments */
      @media (max-width: 600px) {
        #view-mode-row {
          flex-direction: column;
          gap: 24px;
        }
    
        #view-export-form {
          grid-template-columns: 1fr;
          gap: 16px;
        }
    
        #view-export-form .export-pair {
          flex-direction: column;
          align-items: stretch;
          text-align: left;
        }
    
        #view-svg-actions {
          flex-direction: column;
          gap: 10px;
        }
    
        #view-svg-actions .view-action-btn,
        #view-export-form .export-btn {
          width: 100%;
          max-width: 100%;
          box-sizing: border-box;
        }
    
        #view-back-to-edit-btn {
          width: 100%;
        }
      }

      /* Tablet Layout (601px - 1040px) */
      @media (min-width: 601px) and (max-width: 1040px) {
  #view-mode-row {
    display: flex;
    flex-wrap: nowrap;
    gap: 24px;
  }

  .view-col:first-child {
    flex: 1 1 auto;
    min-width: 300px;
  }

      .view-col:last-child {
      flex: 0 0 330px;
      max-width: 330px;
    }
    
    /* Tablet: Form export 1 c·ªôt v·ªõi c√°c c·∫∑p inline */
    #view-export-form {
      grid-template-columns: 1fr;
      gap: 12px;
    }

    #view-export-form .export-pair {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-direction: row;
    }

    #view-export-form .export-label {
      min-width: 70px;
      flex-shrink: 0;
    }

    #view-export-form .export-select {
      flex: 1;
      min-width: 120px;
    }

    #view-export-form .export-number {
      flex: 1;
      min-width: 80px;
    }

    #view-export-form .export-btn-group {
      grid-column: 1 / -1;
      justify-content: center;
      margin-top: 16px;
    }
  }
    </style>
</head>
<body>
  {% include '_navbar.html' %}
    <div class="container">
        <h2>{{ display_name }}</h2>
        <div id="view-mode-row">
            <div class="view-col">
                <div id="view-svg-preview">
                    <img id="view-svg-img" src="{{ svg_url }}" alt="Xem tr∆∞·ªõc h√¨nh ·∫£nh SVG - {{ display_name }}" aria-describedby="svg-description">
                </div>
                <div id="view-svg-actions">
                    <button id="view-copy-link-btn" class="view-action-btn" aria-label="Sao ch√©p li√™n k·∫øt ƒë·∫øn file SVG n√†y">üîó Copy Link</button>
                    <button id="view-download-svg-btn" class="view-action-btn view-download-btn" aria-label="T·∫£i xu·ªëng file SVG">üì• T·∫£i xu·ªëng SVG</button>
                </div>
            </div>
            <div class="view-col">
                <div style="margin-bottom:20px;">
                    <h4 style="color:#333; margin-bottom:15px;">C√°c thao t√°c</h4>
                    <div style="display:flex; flex-direction:column; gap:10px;">
                        <button id="view-back-to-edit-btn" aria-label="Quay v·ªÅ trang ch·ªânh s·ª≠a code TikZ">‚Ü©Ô∏è Quay v·ªÅ ch·ªânh s·ª≠a code TikZ</button>
                    </div>
                </div>
                <div id="view-export-section">
                    <div class="export-section">
                        <h4>Xu·∫•t ·∫£nh PNG/JPEG</h4>
                        <form id="view-export-form" class="export-form">
                            <div class="export-pair">
                                <label for="view-export-format" class="export-label">ƒê·ªãnh d·∫°ng:</label>
                                <select id="view-export-format" class="export-input export-select">
                                    <option value="png">PNG</option>
                                    <option value="jpeg">JPEG</option>
                                </select>
                            </div>
                            <div class="export-pair">
                                <label for="view-export-dpi" class="export-label">DPI:</label>
                                <input type="number" id="view-export-dpi" min="1" class="export-input export-number" placeholder="Auto">
                            </div>
                            <div class="export-pair">
                                <label for="view-export-width" class="export-label">Width (px):</label>
                                <input type="number" id="view-export-width" min="1" class="export-input export-number" placeholder="Auto">
                            </div>
                            <div class="export-pair">
                                <label for="view-export-height" class="export-label">Height (px):</label>
                                <input type="number" id="view-export-height" min="1" class="export-input export-number" placeholder="Auto">
                            </div>
                            <div class="export-btn-group">
                                <button id="view-export-btn" type="button" class="export-btn" aria-label="T·∫£i xu·ªëng file ·∫£nh PNG ho·∫∑c JPEG">T·∫£i xu·ªëng</button>
                            </div>
                        </form>
                        <div id="view-export-msg" class="export-msg"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal ƒëƒÉng xu·∫•t ch·ªâ render n·∫øu ƒë√£ login -->
    {% if user_email %}
    <div id="logout-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.3); z-index:9999; align-items:center; justify-content:center;">
      <div style="background:white; padding:32px 40px; border-radius:12px; box-shadow:0 2px 16px rgba(0,0,0,0.15); min-width:320px; text-align:center;">
        <h3 style="margin-bottom:24px;">ƒêƒÉng xu·∫•t?</h3>
        <a href="/logout" style="display:inline-block; background:#d32f2f; color:white; padding:10px 28px; border-radius:6px; text-decoration:none; font-weight:bold;">ƒêƒÉng xu·∫•t</a>
        <button onclick="document.getElementById('logout-modal').style.display='none'" style="margin-left:18px; background:#eee; color:#333; padding:10px 28px; border-radius:6px; border:none; font-weight:bold;" aria-label="Hu·ª∑ b·ªè ƒëƒÉng xu·∫•t">Hu·ª∑</button>
      </div>
    </div>
    {% endif %}

    <!-- Modal ƒëƒÉng nh·∫≠p -->
    <div id="login-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.3); z-index:9999; align-items:center; justify-content:center;">
      <div style="background:white; padding:32px 40px; border-radius:12px; box-shadow:0 2px 16px rgba(0,0,0,0.15); min-width:320px; text-align:center;">
        <h3 style="margin-bottom:24px;">ƒêƒÉng nh·∫≠p ƒë·ªÉ ti·∫øp t·ª•c</h3>
        <p style="margin-bottom:24px; color:#666;">B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ s·ª≠ d·ª•ng t√≠nh nƒÉng n√†y.</p>
        <button id="modal-login-btn" class="google-login-btn" aria-label="ƒêƒÉng nh·∫≠p b·∫±ng t√†i kho·∫£n Google">
          <span class="google-login-content">
            <svg xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid" viewBox="0 0 256 262" aria-hidden="true" role="img">
              <path fill="#4285F4" d="M255.878 133.451c0-10.734-.871-18.567-2.756-26.69H130.55v48.448h71.947c-1.45 12.04-9.283 30.172-26.69 42.356l-.244 1.622 38.755 30.023 2.685.268c24.659-22.774 38.875-56.282 38.875-96.027"></path>
              <path fill="#34A853" d="M130.55 261.1c35.248 0 64.839-11.605 86.453-31.622l-41.196-31.913c-11.024 7.688-25.82 13.055-45.257 13.055-34.523 0-63.824-22.773-74.269-54.25l-1.531.13-40.298 31.187-.527 1.465C35.393 231.798 79.49 261.1 130.55 261.1"></path>
              <path fill="#FBBC05" d="M56.281 156.37c-2.756-8.123-4.351-16.827-4.351-25.82 0-8.994 1.595-17.697 4.206-25.82l-.073-1.73L15.26 71.312l-1.335.635C5.077 89.644 0 109.517 0 130.55s5.077 40.905 13.925 58.602l42.356-32.782"></path>
              <path fill="#EB4335" d="M130.55 50.479c24.514 0 41.05 10.589 50.479 19.438l36.844-35.974C195.245 12.91 165.798 0 130.55 0 79.49 0 35.393 29.301 13.925 71.947l42.211 32.783c10.59-31.477 39.891-54.251 74.414-54.251"></path>
            </svg>
            ƒêƒÉng nh·∫≠p Google
          </span>
        </button>
        <button onclick="document.getElementById('login-modal').style.display='none'" style="margin-left:18px; background:#eee; color:#333; padding:12px 24px; border-radius:6px; border:none; font-weight:bold;" aria-label="Hu·ª∑ b·ªè ƒëƒÉng nh·∫≠p">Hu·ª∑</button>
      </div>
    </div>

    <!-- JavaScript cho header -->
    <script>
    // Tr·∫°ng th√°i ƒëƒÉng nh·∫≠p t·ª´ server
    const isLoggedIn = {% if user_email %}true{% else %}false{% endif %};
    
    // H√†m hi·ªÉn th·ªã modal ƒëƒÉng nh·∫≠p
    function showLoginModal() {
        document.getElementById('login-modal').style.display = 'flex';
    }
    
    // H√†m ki·ªÉm tra ƒëƒÉng nh·∫≠p tr∆∞·ªõc khi th·ª±c hi·ªán ch·ª©c nƒÉng
    function requireLogin(callback) {
        if (isLoggedIn) {
            callback();
        } else {
            showLoginModal();
        }
    }
    
    // H√†m copy to clipboard
    function copyToClipboard(text, button, originalText) {
        if (navigator.clipboard && window.isSecureContext) {
            navigator.clipboard.writeText(text).then(() => {
                button.textContent = '‚úÖ ƒê√£ copy!';
                setTimeout(() => {
                    button.textContent = originalText;
                }, 2000);
            });
        } else {
            // Fallback cho c√°c tr√¨nh duy·ªát c≈©
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.opacity = 0;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            
            button.textContent = '‚úÖ ƒê√£ copy!';
            setTimeout(() => {
                button.textContent = originalText;
            }, 2000);
        }
    }
    
    // H√†m x·ª≠ l√Ω export PNG/JPEG
    async function handleExport() {
        const format = document.getElementById('view-export-format').value;
        const widthVal = document.getElementById('view-export-width').value;
        const heightVal = document.getElementById('view-export-height').value;
        const dpiVal = document.getElementById('view-export-dpi').value;
        const msg = document.getElementById('view-export-msg');
        const exportBtn = document.getElementById('view-export-btn');
        
        msg.textContent = '';
        
        if ((widthVal && widthVal <= 0) || (heightVal && heightVal <= 0) || (dpiVal && dpiVal <= 0)) {
            msg.textContent = 'Width, Height, DPI ph·∫£i l√† s·ªë d∆∞∆°ng!';
            return;
        }
        
        exportBtn.disabled = true;
        exportBtn.textContent = 'ƒêang x·ª≠ l√Ω...';
        
        try {
            // L·∫•y filename t·ª´ URL
            const filename = window.location.pathname.split('/').pop();
            
            const res = await fetch('/convert', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    filename: filename,
                    fmt: format,
                    width: widthVal || undefined,
                    height: heightVal || undefined,
                    dpi: dpiVal || undefined
                })
            });
            
            const data = await res.json();
            if (data.url) {
                // L·∫•y th√¥ng tin dung l∆∞·ª£ng file v√† k√≠ch th∆∞·ªõc ·∫£nh
                let fileInfoText = '';
                if (data.file_size) {
                    const sizeKB = (data.file_size / 1024).toFixed(1);
                    fileInfoText = `<div style="margin-top: 8px; font-size: 12px; color: #666; text-align: center;">Dung l∆∞·ª£ng: ${sizeKB} KB`;
                    if (data.actual_size) {
                        fileInfoText += ` | K√≠ch th∆∞·ªõc: ${data.actual_size}`;
                    }
                    fileInfoText += '</div>';
                }
                
                msg.className = ''; // X√≥a class error n·∫øu c√≥
                msg.innerHTML = `
                    <a href="${data.url}" download class="export-download-link">T·∫£i v·ªÅ ${format.toUpperCase()}</a>
                    ${fileInfoText}
                `;
            } else {
                msg.className = 'error'; // Th√™m class error
                msg.textContent = data.error || 'L·ªói kh√¥ng x√°c ƒë·ªãnh!';
                
                if (data.estimated_size_mb) {
                    const small = document.createElement('small');
                    small.style.color = '#666';
                    small.textContent = `Dung l∆∞·ª£ng ∆∞·ªõc t√≠nh: ${data.estimated_size_mb}`;
                    msg.appendChild(document.createElement('br'));
                    msg.appendChild(small);
                }
                
                if (data.note) {
                    const small2 = document.createElement('small');
                    small2.style.color = '#666';
                    small2.textContent = data.note;
                    msg.appendChild(document.createElement('br'));
                    msg.appendChild(small2);
                }
            }
        } catch (err) {
            msg.className = 'error'; // Th√™m class error
            msg.textContent = 'L·ªói k·∫øt n·ªëi ho·∫∑c m√°y ch·ªß!';
        }
        
        exportBtn.disabled = false;
        exportBtn.textContent = 'T·∫£i xu·ªëng';
    }
    
    document.addEventListener('DOMContentLoaded', function() {
        // G√°n s·ª± ki·ªán cho n√∫t ƒëƒÉng xu·∫•t
        const logoutBtn = document.getElementById('logout-btn');
        if (logoutBtn) {
            logoutBtn.onclick = () => document.getElementById('logout-modal').style.display = 'flex';
        }
        
        // Mobile logout button
        const mobileLogoutBtn = document.getElementById('mobile-logout-btn');
        if (mobileLogoutBtn) {
            mobileLogoutBtn.onclick = () => document.getElementById('logout-modal').style.display = 'flex';
        }
        
        // Mobile dark mode toggle
        const mobileDarkModeToggle = document.getElementById('mobile-dark-mode-toggle');
        if (mobileDarkModeToggle) {
            mobileDarkModeToggle.onclick = function() {
                // Trigger the same action as desktop dark mode toggle
                const desktopToggle = document.getElementById('dark-mode-toggle');
                if (desktopToggle) {
                    desktopToggle.click();
                }
            };
        }
        
        // Mobile 2-tap functionality
        const mobileNavItems = document.querySelectorAll('.mobile-nav-item');
        let activeTooltip = null;
        
        mobileNavItems.forEach(item => {
            const tooltip = item.querySelector('.mobile-nav-tooltip');
            const action = item.getAttribute('data-action');
            
            // Tap 1: Show tooltip
            item.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Hide previous active tooltip
                if (activeTooltip && activeTooltip !== tooltip) {
                    activeTooltip.classList.remove('active');
                }
                
                // Toggle current tooltip
                tooltip.classList.toggle('active');
                activeTooltip = tooltip.classList.contains('active') ? tooltip : null;
            });
            
            // Tap 2: Execute action when clicking on tooltip
            tooltip.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                // Execute action based on data-action
                switch(action) {
                    case 'home':
                        window.location.href = '/';
                        break;
                    case 'dark-mode':
                        const desktopToggle = document.getElementById('dark-mode-toggle');
                        if (desktopToggle) {
                            desktopToggle.click();
                        }
                        break;
                    case 'profile':
                        window.location.href = '/profile/me';
                        break;
                    case 'logout':
                        document.getElementById('logout-modal').style.display = 'flex';
                        break;
                    case 'login':
                        const currentUrl = window.location.pathname + window.location.search;
                        window.location.href = "{{ url_for('set_next_url') }}?url=" + encodeURIComponent(currentUrl);
                        break;
                }
                
                // Hide tooltip after action
                tooltip.classList.remove('active');
                activeTooltip = null;
            });
        });
        
        // Hide tooltip when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.mobile-nav-item')) {
                if (activeTooltip) {
                    activeTooltip.classList.remove('active');
                    activeTooltip = null;
                }
            }
        });
        
        // G√°n s·ª± ki·ªán cho n√∫t ƒëƒÉng nh·∫≠p Google trong modal
        const modalLoginBtn = document.getElementById('modal-login-btn');
        if (modalLoginBtn) {
            modalLoginBtn.addEventListener('click', function(e) {
                e.preventDefault();
                const currentUrl = window.location.pathname + window.location.search;
                window.location.href = "{{ url_for('set_next_url') }}?url=" + encodeURIComponent(currentUrl);
            });
        }

        // ‚úÖ G√°n s·ª± ki·ªán cho navbar-user-info ƒë·ªÉ quay v·ªÅ profile
        // Kh√¥ng c·∫ßn JavaScript - s·ª≠ d·ª•ng href m·∫∑c ƒë·ªãnh nh∆∞ trang profile

        // G√°n s·ª± ki·ªán cho n√∫t Copy Link
        const copyLinkBtn = document.getElementById('view-copy-link-btn');
        if (copyLinkBtn) {
            copyLinkBtn.onclick = function() {
                requireLogin(() => {
                    // L·∫•y URL c·ªßa file SVG trong /static v√† th√™m t√™n mi·ªÅn
                    const svgPath = '{{ svg_url }}';
                    const baseUrl = window.location.origin;
                    const fullSvgUrl = baseUrl + svgPath;
                    copyToClipboard(fullSvgUrl, this, 'üîó Copy Link');
                });
            };
        }

        // G√°n s·ª± ki·ªán cho n√∫t Download SVG
        const downloadSvgBtn = document.getElementById('view-download-svg-btn');
        if (downloadSvgBtn) {
            downloadSvgBtn.onclick = function() {
                requireLogin(() => {
                    // T·∫°o link t·∫°m th·ªùi ƒë·ªÉ download
                    const svgUrl = '{{ svg_url }}';
                    const link = document.createElement('a');
                    link.href = svgUrl;
                    link.download = '';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                });
            };
        }

        // G√°n s·ª± ki·ªán cho n√∫t "‚Ü©Ô∏è Quay v·ªÅ ch·ªânh s·ª≠a code TikZ"
        const backToEditBtn = document.getElementById('view-back-to-edit-btn');
        if (backToEditBtn) {
            backToEditBtn.onclick = function() {
                requireLogin(() => {
                    // L·∫•y code TikZ ƒë√£ l∆∞u (gi·ªëng logic trang ch·ªß)
                    // NOTE: D√πng tr·ª±c ti·∫øp gi√° tr·ªã Jinja tojson (KH√îNG b·ªçc th√™m d·∫•u nh√°y) ƒë·ªÉ tr√°nh m·∫•t backslash.
                    // ƒë·ªÉ tr√°nh ph·∫£i t·ª± "unescape" d·ªÖ l√†m m·∫•t k√Ω t·ª± backslash c·ªßa TikZ.
                    let currentCode = window.currentViewTikzCode
                                    || localStorage.getItem('tikz_code_for_edit')
                                    || {{ tikz_code|default("")|tojson|safe }};
                    
                    // L∆∞u code v√†o localStorage ƒë·ªÉ trang ch·ªß c√≥ th·ªÉ ƒë·ªçc
                    localStorage.setItem('tikz_code_for_compile', currentCode);
                    
                    // Chuy·ªÉn v·ªÅ trang ch·ªß
                    window.location.href = '/';
                });
            };
        }

        // G√°n s·ª± ki·ªán cho n√∫t T·∫£i xu·ªëng PNG/JPEG
        const exportBtn = document.getElementById('view-export-btn');
        if (exportBtn) {
            exportBtn.onclick = function() {
                requireLogin(function() {
                    handleExport();
                });
            };
        }
        
        // X·ª≠ l√Ω sau khi ƒëƒÉng nh·∫≠p th√†nh c√¥ng
        if (window.location.search.includes('login=1')) {
            // Reload trang ƒë·ªÉ c·∫≠p nh·∫≠t tr·∫°ng th√°i ƒëƒÉng nh·∫≠p
            // Lo·∫°i b·ªè parameter login=1 nh∆∞ng gi·ªØ l·∫°i c√°c parameter kh√°c
            const url = new URL(window.location);
            url.searchParams.delete('login');
            window.location.href = url.pathname + url.search;
        }
        
        // ==== Mobile Menu Toggle ====
        const menuToggle = document.getElementById('menu-toggle');
        const mobileMenu = document.getElementById('mobile-menu');
        const closeMenu = document.getElementById('close-menu');
        
        if (menuToggle && mobileMenu && closeMenu) {
            menuToggle.addEventListener('click', () => mobileMenu.classList.remove('hidden'));
            closeMenu.addEventListener('click', () => mobileMenu.classList.add('hidden'));
            // Optional: click outside to close
            mobileMenu.addEventListener('click', e => {
                if(e.target === mobileMenu) mobileMenu.classList.add('hidden');
            });
        }
    });
    </script>

    <!-- Highlight.js JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/latex.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
    
    <!-- Initialize highlight.js after loading libraries -->
    <script>
        // Initialize highlight.js
        hljs.highlightAll();
        hljs.initLineNumbersOnLoad();
    </script>
    
    <footer style='text-align:center;color:#888;font-size:14px;margin-top:40px;'>¬© 2024 TikZ2SVG - All rights reserved.</footer>
</body>
</html> 
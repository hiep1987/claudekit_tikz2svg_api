<nav class="container bg-white/80 backdrop-blur nv-shadow rounded-2xl p-3 flex items-center justify-between mb-8 border border-white/20 hover:shadow-xl transition-all duration-300" style="min-height: auto; height: auto;">
    <!-- Logo -->
    <div class="flex items-center gap-2 flex-shrink-0">
        <a href="/" class="flex items-center gap-2 hover:opacity-80 transition-opacity" style="text-decoration: none;">
            <img src="{{ url_for('static', filename='logo-transparent.svg') }}" 
                 alt="TikZ to SVG Logo" 
                 class="rounded-lg shadow-sm"
                 style="width: 30px; height: 30px; object-fit: contain;">
            <span class="text-lg font-bold text-gray-800">TikZ to SVG</span>
        </a>
    </div>

    <!-- Menu - Desktop (Hidden) -->
    <div class="hidden">
        <ul id="main-menu" class="list-unstyled p-0 m-0 d-flex align-items-center gap-3 font-medium text-gray-700">
            <li class="menu-item relative px-2 py-1 cursor-pointer transition hover:text-blue-600">
                <a href="/" class="block text-base" style="line-height: 1;">Trang chủ</a>
                <div class="menu-underline"></div>
            </li>
            {% if current_user.is_authenticated %}
            <li class="menu-item relative px-2 py-1 cursor-pointer transition hover:text-blue-600">
                <a href="/profile/{{ current_user.id }}/settings" class="block text-base" style="line-height: 1;">Hồ sơ</a>
                <div class="menu-underline"></div>
            </li>
            <li class="menu-item relative px-2 py-1 cursor-pointer transition hover:text-blue-600">
                <a href="/profile/{{ current_user.id }}/svg-files" class="block text-base" style="line-height: 1;">File SVG</a>
                <div class="menu-underline"></div>
            </li>
            <li class="menu-item relative px-2 py-1 cursor-pointer transition hover:text-blue-600">
                <a href="/profile/{{ current_user.id }}/followed-posts" class="block text-base" style="line-height: 1;">Bài đăng</a>
                <div class="menu-underline"></div>
            </li>
            {% endif %}
            <li class="menu-item relative px-2 py-1 cursor-pointer transition hover:text-blue-600">
                <a href="/packages" class="block text-base flex items-center gap-1" style="line-height: 1;">
                    <i class="fas fa-cube" style="font-size: 14px;"></i>
                    Packages
                </a>
                <div class="menu-underline"></div>
            </li>
            <li class="menu-item relative px-2 py-1 cursor-pointer transition hover:text-blue-600">
                <a href="/docs" class="block text-base flex items-center gap-1" style="line-height: 1;">
                    <i class="fas fa-book" style="font-size: 14px;"></i>
                    Tài liệu
                </a>
                <div class="menu-underline"></div>
            </li>
        </ul>
    </div>

    <!-- Avatar/User or Login & Hamburger -->
    <div class="flex items-center gap-2 flex-shrink-0">
        {% if current_user.is_authenticated %}
            <div class="flex items-center gap-2">
                <!-- Notifications Bell -->
                <div class="tikz-app notifications-container" style="position: relative; display: inline-block; height: auto; min-height: auto; width: auto;">
                    <button class="notifications-bell" id="notificationsBell" aria-label="Thông báo" style="position: relative; background: transparent; border: none; cursor: pointer; padding: 8px; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-bell" style="font-size: 18px; color: #4b5563;"></i>
                        <span class="notification-badge" id="notificationBadge" style="display: none; position: absolute; top: 0px; right: -2px; background: #ef4444; color: white; font-size: 10px; font-weight: 600; padding: 2px 5px; border-radius: 10px; min-width: 16px; text-align: center;">0</span>
                    </button>
                    
                    <!-- Notifications Dropdown (hidden by default, positioned absolutely) -->
                    <div class="notifications-dropdown" id="notificationsDropdown">
                        <div class="notifications-header" style="display: flex; justify-content: space-between; align-items: center; padding: 16px; border-bottom: 1px solid #eee;">
                            <h3 style="margin: 0; font-size: 16px; font-weight: 600;">Thông báo</h3>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <button class="toggle-view-btn" id="toggleViewBtn" style="background: none; border: 1px solid #e5e7eb; color: #6b7280; font-size: 12px; cursor: pointer; padding: 4px 8px; border-radius: 6px; transition: all 0.2s;">
                                    Xem tất cả
                                </button>
                                <button class="mark-all-read-btn" id="markAllReadBtn" style="background: none; border: none; color: #1976d2; font-size: 13px; cursor: pointer; padding: 4px 8px; border-radius: 4px;">
                                    Đánh dấu tất cả đã đọc
                                </button>
                            </div>
                        </div>
                        
                        <div class="notifications-list" id="notificationsList" style="max-height: 400px; overflow-y: auto;">
                            <!-- Notifications sẽ được load bằng JavaScript -->
                            <div class="notifications-loading" style="padding: 40px 20px; text-align: center; color: #6c757d;">
                                <i class="fas fa-spinner fa-spin"></i>
                                Đang tải...
                            </div>
                        </div>
                    </div>
                </div>
                
                <a href="/profile/{{ current_user.id }}/settings" class="flex items-center gap-2 bg-gray-100 px-2 py-1.5 rounded-lg border border-gray-300 hover:bg-gray-200 hover:border-gray-400 transition-all duration-200 cursor-pointer">
                    {% if current_avatar %}
                        <img src="{{ url_for('static', filename='avatars/' ~ current_avatar) }}" 
                             alt="Avatar" class="w-6 h-6 rounded-full"
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    {% endif %}
                    {% if not current_avatar %}
                        <div class="w-6 h-6 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold text-xs">
                            {{ current_user_email[0].upper() if current_user_email else 'U' }}
                        </div>
                    {% endif %}
                    <span class="text-xs font-medium text-gray-700 flex items-center gap-1">
                        {{ current_username or (current_user_email.split('@')[0] if current_user_email) }}
                        {% if current_identity_verified %}
                            <img src="{{ url_for('static', filename='identity-verification-icon.svg') }}" alt="Verified" style="width: 14px; height: 14px; vertical-align: middle;" />
                        {% endif %}
                    </span>
                </a>
            </div>
        {% else %}
            <button class="hidden md:block bg-gradient-to-r from-blue-400 to-yellow-400 text-white px-3 py-1.5 rounded-xl shadow hover:scale-105 transition-all duration-200 font-semibold text-sm border-0 hover:from-blue-500 hover:to-yellow-500 focus:outline-none focus:ring-2 focus:ring-blue-300 focus:ring-opacity-50" onclick="window.location.href='/login/google'">Đăng nhập</button>
        {% endif %}
        <!-- Hamburger (mobile) -->
        <button id="menu-toggle" class="md:hidden p-1.5 rounded-lg hover:bg-blue-100 transition">
            <i class="fas fa-bars text-lg"></i>
        </button>
    </div>
</nav>

<!-- Scrollable Menu - Always Visible -->
<div id="scrollable-menu" class="container mb-8">
    <ul id="scrollable-menu-list" class="list-unstyled p-0 m-0 d-flex align-items-center gap-3 font-medium text-gray-700 px-3">
        <li class="menu-item relative px-2 py-1 cursor-pointer transition hover:text-blue-600">
            <a href="/" class="block text-base" style="line-height: 1;">Trang chủ</a>
            <div class="menu-underline"></div>
        </li>
        {% if current_user.is_authenticated %}
        <li class="menu-item relative px-2 py-1 cursor-pointer transition hover:text-blue-600">
            <a href="/profile/{{ current_user.id }}/settings" class="block text-base" style="line-height: 1;">Hồ sơ</a>
            <div class="menu-underline"></div>
        </li>
        <li class="menu-item relative px-2 py-1 cursor-pointer transition hover:text-blue-600">
            <a href="/profile/{{ current_user.id }}/svg-files" class="block text-base" style="line-height: 1;">File SVG</a>
            <div class="menu-underline"></div>
        </li>
        <li class="menu-item relative px-2 py-1 cursor-pointer transition hover:text-blue-600">
            <a href="/profile/{{ current_user.id }}/followed-posts" class="block text-base" style="line-height: 1;">Bài đăng</a>
            <div class="menu-underline"></div>
        </li>
        {% endif %}
        <li class="menu-item relative px-2 py-1 cursor-pointer transition hover:text-blue-600">
            <a href="/packages" class="block text-base flex items-center gap-1" style="line-height: 1;">
                <i class="fas fa-cube" style="font-size: 14px;"></i>
                Packages
            </a>
            <div class="menu-underline"></div>
        </li>
        <li class="menu-item relative px-2 py-1 cursor-pointer transition hover:text-blue-600">
            <a href="/docs" class="block text-base flex items-center gap-1" style="line-height: 1;">
                <i class="fas fa-book" style="font-size: 14px;"></i>
                Tài liệu
            </a>
            <div class="menu-underline"></div>
        </li>
    </ul>
    
</div>

<!-- Mobile Menu -->
<div id="mobile-menu" class="fixed top-0 left-0 w-full h-full bg-black/50 z-400 hidden">
    <div class="absolute right-0 top-0 w-60 bg-white h-full nv-shadow flex flex-col p-6 gap-3">
        <button id="close-menu" class="self-end text-2xl text-gray-500 hover:text-blue-400">
            <i class="fas fa-times"></i>
        </button>
        <a href="/" class="py-2 px-3 rounded-lg text-gray-700 font-medium hover:bg-blue-100 transition">Trang chủ</a>
        {% if current_user.is_authenticated %}
        <a href="/profile/{{ current_user.id }}/settings" class="py-2 px-3 rounded-lg text-gray-700 font-medium hover:bg-blue-100 transition">Hồ sơ</a>
        <a href="/profile/{{ current_user.id }}/svg-files" class="py-2 px-3 rounded-lg text-gray-700 font-medium hover:bg-blue-100 transition">File SVG</a>
        <a href="/profile/{{ current_user.id }}/followed-posts" class="py-2 px-3 rounded-lg text-gray-700 font-medium hover:bg-blue-100 transition">Bài đăng</a>
        {% endif %}
        <a href="/packages" class="py-2 px-3 rounded-lg text-gray-700 font-medium hover:bg-blue-100 transition flex items-center gap-2">
            <i class="fas fa-cube" style="font-size: 14px;"></i>
            Packages
        </a>
        <a href="/docs" class="py-2 px-3 rounded-lg text-gray-700 font-medium hover:bg-blue-100 transition flex items-center gap-2">
            <i class="fas fa-book" style="font-size: 14px;"></i>
            Tài liệu
        </a>
        {% if current_user.is_authenticated %}
        <button id="mobile-logout-btn" class="logout-btn bg-gradient-to-r from-red-400 to-red-600 text-white px-4 py-2 rounded-xl shadow font-semibold mt-2 text-center border-0 w-full hover:from-red-500 hover:to-red-700 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-red-300 focus:ring-opacity-50">Đăng xuất</button>
        {% else %}
        <button class="login-btn bg-gradient-to-r from-blue-600 to-blue-800 text-white px-4 py-2 rounded-xl shadow-lg font-semibold mt-8 hover:from-blue-700 hover:to-blue-900 transition-all duration-200" onclick="window.location.href='/login/google'">Đăng nhập</button>
        {% endif %}
    </div>
</div>



<!DOCTYPE html>
<html lang="vi" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="C√†i ƒë·∫∑t v√† qu·∫£n l√Ω h·ªì s∆° ng∆∞·ªùi d√πng TikZ to SVG">
    <meta name="keywords" content="TikZ, SVG, profile settings, user settings">
    <meta name="author" content="TikZ to SVG">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="C√†i ƒë·∫∑t h·ªì s∆° - TikZ to SVG">
    <meta property="og:description" content="C√†i ƒë·∫∑t v√† qu·∫£n l√Ω h·ªì s∆° ng∆∞·ªùi d√πng TikZ to SVG">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="vi_VN">
    <title>C√†i ƒë·∫∑t h·ªì s∆° - TikZ to SVG</title>
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='favicon-16x16.png') }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicon-32x32.png') }}">
    <link rel="icon" type="image/png" sizes="48x48" href="{{ url_for('static', filename='favicon-48x48.png') }}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='apple-touch-icon.png') }}">
    <link rel="icon" type="image/png" sizes="192x192" href="{{ url_for('static', filename='android-chrome-192x192.png') }}">
    <link rel="icon" type="image/png" sizes="512x512" href="{{ url_for('static', filename='android-chrome-512x512.png') }}">
    <link rel="shortcut icon" type="image/png" href="{{ url_for('static', filename='favicon-32x32.png') }}">
    
    <!-- Navigation CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/navigation.css', v='1.0') }}">
    
    <!-- Cropper.js CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet">
    
    <!-- Quill Editor CSS -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    
    <!-- Bio Editor Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bio-editor.css', v='1.0') }}">
    
    <!-- Profile Settings Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/profile_settings.css', v='1.0') }}">

</head>
<body>
    {% include '_navbar.html' %}

    <div class="container">
        <!-- Profile Settings Content -->
        <div id="profile-content" class="profile-content show">
            <div class="header">
                <h1>üë§ H·ªì s∆° c√° nh√¢n</h1>
                <p>Qu·∫£n l√Ω th√¥ng tin t√†i kho·∫£n c·ªßa b·∫°n</p>
            </div>

            <!-- Flash Messages -->
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    <div class="flash-messages">
                        {% for category, message in messages %}
                            <div class="flash flash-{{ 'success' if category == 'success' else 'error' }}">
                                {{ message }}
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}

            <form method="POST" enctype="multipart/form-data">
                <div class="profile-section">
                    <!-- Avatar Section -->
                    <div class="avatar-section">
                        <div class="avatar-container">
                            {% if avatar %}
                                <img src="{{ url_for('static', filename='avatars/' ~ avatar) }}" alt="Avatar" class="avatar" id="avatar-preview">
                            {% else %}
                                <div class="avatar-placeholder" id="avatar-placeholder">
                                    {{ user_email[0].upper() if user_email else 'U' }}
                                </div>
                            {% endif %}
                        </div>
                        <div class="avatar-upload">
                            <input type="file" id="avatar-input" name="avatar" accept="image/*">
                            <label for="avatar-input">üì∑ Ch·ªçn ·∫£nh ƒë·∫°i di·ªán</label>
                        </div>
                        <p class="text-small">
                            H·ªó tr·ª£: JPG, PNG, GIF (t·ªëi ƒëa 5MB)
                        </p>
                    </div>

                    <!-- Info Section -->
                    <div class="info-section">
                        <div class="info-group">
                            <label for="email">üìß Email:
                                {% if email_verified %}
                                    <span class="text-success">‚úî ƒê√£ x√°c th·ª±c</span>
                                {% else %}
                                    <span class="text-warning">‚ö† Ch∆∞a x√°c th·ª±c</span>
                                {% endif %}
                            </label>
                            <input type="email" id="email" value="{{ user_email }}" class="readonly" readonly>
                            <small class="text-muted">Email kh√¥ng th·ªÉ thay ƒë·ªïi</small>
                        </div>

                        <div class="info-group">
                            <label>üîê X√°c th·ª±c danh t√≠nh:
                                {% if identity_verified %}
                                    <span class="text-success">‚úî ƒê√£ x√°c th·ª±c</span>
                                    <img src="{{ url_for('static', filename='identity-verification-icon.svg') }}" alt="Verified" class="verification-icon">
                                {% else %}
                                    <span class="text-warning">‚ö† Ch∆∞a x√°c th·ª±c</span>
                                {% endif %}
                            </label>
                            {% if not identity_verified %}
                                <div class="verification-button-container">
                                    <a href="{{ url_for('profile_verification') }}" class="btn btn-primary verification-button">
                                        üîê X√°c th·ª±c t√†i kho·∫£n
                                    </a>
                                    <small class="text-muted-block">
                                        X√°c th·ª±c ƒë·ªÉ m·ªü kh√≥a ƒë·∫ßy ƒë·ªß t√≠nh nƒÉng v√† nh·∫≠n badge x√°c th·ª±c
                                    </small>
                                </div>
                            {% else %}
                                <div class="verification-success">
                                    <strong>‚úÖ T√†i kho·∫£n ƒë√£ ƒë∆∞·ª£c x√°c th·ª±c!</strong><br>
                                    <small>B·∫°n c√≥ th·ªÉ truy c·∫≠p ƒë·∫ßy ƒë·ªß c√°c t√≠nh nƒÉng c·ªßa n·ªÅn t·∫£ng.</small>
                                </div>
                            {% endif %}
                        </div>

                        <div class="info-group">
                            <label for="username">üë§ T√™n hi·ªÉn th·ªã:</label>
                            <input type="text" id="username" name="username" value="{{ username or '' }}" 
                                   placeholder="Nh·∫≠p t√™n hi·ªÉn th·ªã c·ªßa b·∫°n" maxlength="50">
                            <small class="text-muted">T√™n s·∫Ω hi·ªÉn th·ªã trong ·ª©ng d·ª•ng</small>
                        </div>

                        <div class="info-group">
                            <label for="bio">üìù M√¥ t·∫£ / Gi·ªõi thi·ªáu:</label>
                            <!-- Quill Editor Container -->
                            <div id="bio-editor">{{ bio|safe }}</div>
                            <input type="hidden" name="bio" id="bio-hidden">
                            <small class="text-muted">B·∫°n c√≥ th·ªÉ chia s·∫ª v·ªÅ m√¨nh (h·ªó tr·ª£ ƒë·ªãnh d·∫°ng: B, I, U, bullets, m√†u s·∫Øc)</small>
                        </div>
                    </div>
                </div>
                <input type="hidden" id="avatar-cropped-blob" name="avatar_cropped" value="">

                <div class="actions" id="save-button-section">
                    <button type="submit" class="btn btn-primary">üíæ L∆∞u thay ƒë·ªïi</button>
                </div>
                
                <!-- Form x√°c th·ª±c -->
                <div id="verification-section" class="verification-section{% if has_pending_verification %} show{% endif %}">
                    <h3 class="verification-title">üîê X√°c th·ª±c thay ƒë·ªïi</h3>
                    <p class="verification-text">
                        Ch√∫ng t√¥i ƒë√£ g·ª≠i m√£ x√°c th·ª±c ƒë·∫øn email c·ªßa b·∫°n. Vui l√≤ng nh·∫≠p m√£ ƒë·ªÉ ho√†n t·∫•t thay ƒë·ªïi.
                        <br><small class="verification-note">üí° <strong>L∆∞u √Ω:</strong> Email c√≥ th·ªÉ n·∫±m trong th∆∞ m·ª•c Spam/Junk. N·∫øu kh√¥ng nh·∫≠n ƒë∆∞·ª£c email, vui l√≤ng li√™n h·ªá <a href="mailto:support@tikz2svg.com" class="verification-link">support@tikz2svg.com</a> ƒë·ªÉ ƒë∆∞·ª£c h·ªó tr·ª£.</small>
                    </p>
                    
                    {% if verification_attempts > 0 %}
                    <div class="verification-alert {% if verification_attempts >= 4 %}verification-alert-danger{% else %}verification-alert-warning{% endif %}">
                        <p class="{% if verification_attempts >= 4 %}verification-alert-text-danger{% else %}verification-alert-text-warning{% endif %}">
                            {% if verification_attempts >= 4 %}
                            üö® <strong>C·∫£nh b√°o:</strong> B·∫°n ƒë√£ nh·∫≠p sai {{ verification_attempts }} l·∫ßn. C√≤n {{ 5 - verification_attempts }} l·∫ßn th·ª≠ cu·ªëi c√πng!
                            {% else %}
                            ‚ö†Ô∏è B·∫°n ƒë√£ nh·∫≠p sai {{ verification_attempts }} l·∫ßn. C√≤n {{ 5 - verification_attempts }} l·∫ßn th·ª≠.
                            {% endif %}
                        </p>
                        {% if verification_attempts >= 3 %}
                        <p class="verification-alert-hint {% if verification_attempts >= 4 %}verification-alert-text-danger{% else %}verification-alert-text-warning{% endif %}">
                            üí° <strong>G·ª£i √Ω:</strong> Ki·ªÉm tra l·∫°i email, bao g·ªìm th∆∞ m·ª•c Spam/Junk. Ho·∫∑c nh·∫•n "H·ªßy b·ªè" ƒë·ªÉ th·ª≠ l·∫°i t·ª´ ƒë·∫ßu.
                        </p>
                        {% endif %}
                    </div>
                    {% endif %}
                    
                    <div class="info-group">
                        <label for="verification_code">üìß M√£ x√°c th·ª±c:</label>
                        <input type="text" id="verification_code" name="verification_code" 
                               placeholder="Nh·∫≠p m√£ 6 s·ªë t·ª´ email" maxlength="6" 
                               autocomplete="one-time-code" inputmode="numeric" pattern="[0-9]*" enterkeyhint="done"
                               autocapitalize="off" autocorrect="off" spellcheck="false"
                               class="verification-code-input">
                        <small class="text-muted">M√£ c√≥ hi·ªáu l·ª±c trong 24 gi·ªù</small>
                    </div>
                    
                    <div class="actions">
                        <button type="submit" class="btn btn-primary">‚úÖ X√°c nh·∫≠n thay ƒë·ªïi</button>
                        <button type="button" id="cancel-verification-btn" class="btn btn-secondary">‚ùå H·ªßy b·ªè</button>
                    </div>
                </div>
            </form>
        </div>
    </div>



    <!-- Modal cropper avatar -->
    <div id="avatar-cropper-modal" class="avatar-cropper-modal">
      <div class="cropper-modal-content">
        <h3 class="cropper-modal-title">Ch·ªânh s·ª≠a ·∫£nh ƒë·∫°i di·ªán</h3>
        <div class="cropper-preview-container">
          <div class="cropper-preview">
            <img id="cropper-image" src="" class="cropper-image" alt="Cropper Preview">
          </div>
        </div>
        <div class="cropper-actions">
          <button type="button" id="crop-avatar-btn" class="btn btn-primary">C·∫Øt & L∆∞u</button>
          <button type="button" id="close-cropper-btn" class="btn btn-secondary">Hu·ª∑</button>
        </div>
      </div>
    </div>

    <!-- JavaScript cho header -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    
    <!-- Quill Editor -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
    <script src="{{ url_for('static', filename='js/profile_settings.js', v='1.0') }}"></script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html> 
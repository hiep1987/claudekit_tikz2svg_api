<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Xem SVG - {{ display_name }}</title>
    <meta property="og:title" content="TikZ to SVG - {{ display_name }}" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="{{ request.host_url.rstrip('/') ~ png_url }}" />
    <meta property="og:url" content="{{ request.host_url.rstrip('/') ~ url_for('view_svg', filename=filename) }}" />
    <meta property="og:description" content="Xem v√† chia s·∫ª h√¨nh TikZ SVG tr·ª±c tuy·∫øn." />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Highlight.js CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; margin: 0; }
        .container { max-width: 900px; margin: 30px auto; background: #fff; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); padding: 32px; }
        h2 { text-align: center; color: #1976d2; margin-bottom: 24px; }
        .svg-view-block { display: flex; flex-wrap: wrap; gap: 32px; }
        .svg-col { flex: 1; min-width: 0; }
        .svg-preview { background: #fff; border: 1.5px solid #eee; border-radius: 8px; min-height: 320px; display: flex; align-items: center; justify-content: center; padding: 16px; width: 100%; box-sizing: border-box; }
        .svg-preview img { max-width: 100%; max-height: 420px; display: block; margin: 0 auto; }
        .code-section { margin-top: 24px; }
        .code-title { font-weight: bold; color: #333; margin-bottom: 8px; }
        .code-block { 
            background: #f8f9fa; 
            border: 1px solid #e9ecef; 
            border-radius: 5px; 
            padding: 0; 
            font-family: 'Courier New', monospace; 
            font-size: 13px; 
            overflow-x: auto; 
            max-height: 400px;
            position: relative;
        }
        .code-block pre {
            margin: 0;
            padding: 15px;
            background: transparent;
        }
        .code-block code {
            background: transparent;
            padding: 0;
        }
        /* Line numbers */
        .hljs-ln-numbers {
            text-align: right;
            color: #999;
            border-right: 1px solid #ddd;
            vertical-align: top;
            padding-right: 8px !important;
            min-width: 25px;
        }
        .hljs-ln-code {
            padding-left: 8px !important;
        }
        @media (max-width: 900px) {
            .svg-view-block {
                flex-direction: column;
                gap: 16px;
            }
            .svg-preview {
                min-height: 180px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .svg-col {
                width: 100%;
                max-width: 100%;
            }
        }
        
        /* Navbar user info styles */
        .navbar-user-info {
            padding: 6px 14px;
            border-radius: 6px;
            gap: 8px;
            background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
            color: white;
            font-size: 14px;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 4px rgba(25, 118, 210, 0.2);
            transition: all 0.2s ease;
            text-decoration: none;
            cursor: pointer;
        }

        .navbar-user-info:hover {
            background: linear-gradient(135deg, #1565c0 0%, #0d47a1 100%);
            box-shadow: 0 4px 8px rgba(25, 118, 210, 0.3);
        }

        .navbar-avatar,
        .navbar-avatar-placeholder {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 2px solid #fff;
            object-fit: cover;
            background: #eee;
            flex-shrink: 0;
        }
        
        .navbar-avatar-placeholder {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }

        .navbar-username {
            font-weight: 500;
            font-size: 13.5px;
            max-width: 100px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* Responsive t·ªëi ∆∞u cho mobile/iPhone */
        @media (max-width: 600px) {
            .profile-navbar {
                flex-direction: column !important;
                align-items: stretch !important;
                gap: 10px !important;
                margin-bottom: 16px !important;
            }
            .profile-navbar > div {
                width: 100% !important;
                display: flex !important;
                flex-wrap: wrap !important;
                gap: 8px !important;
                justify-content: center !important;
            }

            .profile-navbar a,
            .profile-navbar button {
                flex: 1 1 auto !important;
                width: 100% !important;
                text-align: center !important;
                font-size: 16px !important;
                padding: 12px 0 !important;
                box-sizing: border-box !important;
            }

            .navbar-user-info {
                padding: 8px 12px;
                gap: 6px;
                border-radius: 6px;
                justify-content: center;
            }

            .navbar-avatar,
            .navbar-avatar-placeholder {
                width: 26px;
                height: 26px;
            }

            .navbar-username {
                font-size: 13px;
                max-width: 90px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="profile-navbar" style="display:flex; gap:12px; align-items:center; justify-content:space-between; margin-bottom:18px;">
            <div style="display:flex; gap:12px; align-items:center;">
                <a href="/" class="btn btn-secondary" style="text-decoration: none; background:#6c757d; color:white; padding:8px 16px; border-radius:6px; font-weight:bold; font-size:14px;">üè† V·ªÅ trang ch·ªß</a>
            </div>
            <div style="display:flex; gap:12px; align-items:center;">
                {% if user_email %}
                    <a href="/profile" class="navbar-user-info">
                        <img src="{{ url_for('static', filename='avatars/' ~ avatar) if avatar else '' }}"
                             alt="Avatar" class="navbar-avatar"
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        {% if not avatar %}
                        <div class="navbar-avatar-placeholder">
                            {{ user_email[0].upper() }}
                        </div>
                        {% endif %}
                        <span class="navbar-username">
                            {{ username or user_email.split('@')[0] }}
                        </span>
                    </a>
                    <a id="logout-btn" href="#" style="background:#d32f2f; color:white; padding:8px 16px; border-radius:6px; text-decoration:none; font-weight:bold; font-size:14px;">ƒêƒÉng xu·∫•t</a>
                {% else %}
                    <a id="user-email-btn" class="btn-header-login" style="background:#1976d2; color:white; padding:8px 18px; border-radius:6px; text-decoration:none; font-weight:bold; min-width:180px; text-align:center;">ƒêƒÉng nh·∫≠p Google</a>
                {% endif %}
            </div>
        </div>

        <h2>{{ display_name }}</h2>
        <div class="svg-view-block">
            <div class="svg-col">
                <div class="svg-preview">
                    <img src="{{ svg_url }}" alt="SVG Preview">
                </div>
                <div class="code-section">
                    <div class="code-title">Code TikZ g·ªëc:</div>
                    <div class="code-block">
                        {% if user_email and tikz_code %}
                        <pre><code class="language-latex">{{ tikz_code }}</code></pre>
                        {% else %}
                        <div style="text-align:center; color:#888; padding:32px 0; font-size:16px;">ƒêƒÉng nh·∫≠p ƒë·ªÉ xem code g·ªëc</div>
                        {% endif %}
                    </div>
                    <div style="text-align:center; margin-top:18px;">
                        {% if tikz_code %}
                        <button id="view-compile-btn" style="background:#1976d2;color:white;padding:8px 18px;border:none;border-radius:6px;font-weight:bold;cursor:pointer;">üëÅÔ∏è Xem v√† Bi√™n d·ªãch</button>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal ƒëƒÉng xu·∫•t ch·ªâ render n·∫øu ƒë√£ login -->
    {% if user_email %}
    <div id="logout-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.3); z-index:9999; align-items:center; justify-content:center;">
      <div style="background:white; padding:32px 40px; border-radius:12px; box-shadow:0 2px 16px rgba(0,0,0,0.15); min-width:320px; text-align:center;">
        <h3 style="margin-bottom:24px;">ƒêƒÉng xu·∫•t?</h3>
        <a href="/logout" style="display:inline-block; background:#d32f2f; color:white; padding:10px 28px; border-radius:6px; text-decoration:none; font-weight:bold;">ƒêƒÉng xu·∫•t</a>
        <button onclick="document.getElementById('logout-modal').style.display='none'" style="margin-left:18px; background:#eee; color:#333; padding:10px 28px; border-radius:6px; border:none; font-weight:bold;">Hu·ª∑</button>
      </div>
    </div>
    {% endif %}

    <!-- JavaScript cho header -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // G√°n s·ª± ki·ªán cho n√∫t ƒëƒÉng xu·∫•t
        const logoutBtn = document.getElementById('logout-btn');
        if (logoutBtn) {
            logoutBtn.onclick = () => document.getElementById('logout-modal').style.display = 'flex';
        }
        
        // G√°n s·ª± ki·ªán cho n√∫t ƒëƒÉng nh·∫≠p
        const loginBtn = document.getElementById('user-email-btn');
        if (loginBtn) {
            loginBtn.href = "/login/google";
        }
    });
    </script>

    <!-- Highlight.js JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/latex.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
    <script>
        // Initialize highlight.js
        document.addEventListener('DOMContentLoaded', function() {
            hljs.highlightAll();
            hljs.initLineNumbersOnLoad();
        });
    </script>
    {% if tikz_code %}
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        var btn = document.getElementById('view-compile-btn');
        if (btn) {
            btn.onclick = function() {
                var tikz = {{ tikz_code|tojson|safe }};
                var filename = {{ filename|tojson|safe }};
                var isLoggedIn = {{ 'true' if user_email else 'false' }};
                if (isLoggedIn === true || isLoggedIn === 'true') {
                    // ƒê√£ ƒëƒÉng nh·∫≠p: l∆∞u th√¥ng tin v√† chuy·ªÉn v·ªÅ trang ch·ªß
                    localStorage.setItem('tikz_code_for_compile', tikz);
                    localStorage.setItem('svg_filename_for_compile', filename);
                    window.location.href = '/';
                } else {
                    // Ch∆∞a ƒëƒÉng nh·∫≠p: l∆∞u th√¥ng tin v√† chuy·ªÉn v·ªÅ trang ch·ªß (·∫©n code)
                    localStorage.setItem('pending_view_svg', JSON.stringify({
                        tikzCode: tikz,
                        svgFilename: filename
                    }));
                    window.location.href = '/';
                }
            };
        }
    });
    </script>
    {% endif %}
    <footer style='text-align:center;color:#888;font-size:14px;margin-top:40px;'>¬© 2024 TikZ2SVG - All rights reserved.</footer>
</body>
</html> 
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Xem SVG - {{ display_name }}</title>
    <meta property="og:title" content="TikZ to SVG - {{ display_name }}" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="{{ request.host_url.rstrip('/') ~ png_url }}" />
    <meta property="og:url" content="{{ request.host_url.rstrip('/') ~ url_for('view_svg', filename=filename) }}" />
    <meta property="og:description" content="Xem v√† chia s·∫ª h√¨nh TikZ SVG tr·ª±c tuy·∫øn." />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Highlight.js CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <style>
      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: #f5f5f5;
        margin: 0;
      }
    
      .container {
        max-width: 1000px;
        margin: 30px auto;
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        padding: 32px;
      }
    
      h2 {
        text-align: center;
        color: #1976d2;
        margin-bottom: 24px;
      }
    
      /* Profile Navbar */
      .profile-navbar {
        display: flex;
        gap: 12px;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 18px;
        flex-wrap: wrap;
      }
    
      .profile-navbar a,
      .profile-navbar button {
        text-decoration: none;
        border: none;
        border-radius: 6px;
        padding: 8px 16px;
        font-weight: bold;
        font-size: 14px;
        cursor: pointer;
        transition: background 0.2s;
        box-sizing: border-box;
      }
    
      .profile-navbar a {
        background: #1976d2;
        color: white;
      }
    
      .profile-navbar a:hover {
        background: #1565c0;
      }
    
      .profile-navbar .logout-btn {
        background: #d32f2f;
        color: white;
      }
    
      .profile-navbar .logout-btn:hover {
        background: #b71c1c;
      }
    
      .navbar-user-info {
        display: flex;
        align-items: center;
        gap: 10px;
        background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
        color: white;
        padding: 8px 16px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(25, 118, 210, 0.1);
        text-decoration: none;
        cursor: pointer;
        transition: all 0.2s;
      }
    
      .navbar-user-info:hover {
        background: linear-gradient(135deg, #1565c0 0%, #0d47a1 100%);
        box-shadow: 0 4px 12px rgba(25, 118, 210, 0.2);
      }
    
      .navbar-avatar,
      .navbar-avatar-placeholder {
        width: 28px;
        height: 28px;
        border-radius: 50%;
        border: 2px solid #fff;
        object-fit: cover;
        background: #eee;
        flex-shrink: 0;
      }
    
      .navbar-avatar-placeholder {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 14px;
      }
    
      .navbar-username {
        font-weight: 500;
        font-size: 13.5px;
        max-width: 100px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
    
      /* View Mode Row Layout */
      #view-mode-row {
        display: flex;
        gap: 32px;
        margin-bottom: 24px;
        flex-wrap: wrap;
      }
    
      .view-col {
        flex: 1 1 300px;
        min-width: 280px;
        box-sizing: border-box;
      }
    
      /* SVG Preview Block */
      #view-svg-preview {
        background: #fff;
        border: 1.5px solid #eee;
        border-radius: 8px;
        padding: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 320px;
        height: 400px;
        width: 100%;
        box-sizing: border-box;
      }
    
      #view-svg-preview img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        display: block;
        margin: 0 auto;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      }
    
      /* Action Buttons below SVG */
      #view-svg-actions {
        margin-top: 16px;
        display: flex;
        gap: 12px;
        justify-content: center;
        flex-wrap: wrap;
      }
    
      #view-svg-actions .view-action-btn {
        background: #ffc107;
        color: #212529;
        padding: 12px 20px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        text-decoration: none;
        box-shadow: 0 2px 8px rgba(255,193,7,0.2);
        transition: all 0.2s;
      }
    
      #view-svg-actions .view-action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(255,193,7,0.3);
      }
    
      #view-svg-actions .view-download-btn {
        background: #17a2b8;
        color: white;
      }
    
      #view-svg-actions .view-download-btn:hover {
        box-shadow: 0 4px 12px rgba(23,162,184,0.3);
      }
    
      /* Back to Edit Button */
      #view-back-to-edit-btn {
        background: linear-gradient(90deg, #28a745 0%, #218838 100%);
        color: white;
        padding: 12px 20px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }
    
      #view-back-to-edit-btn:hover {
        box-shadow: 0 4px 12px rgba(40,167,69,0.3);
        transform: translateY(-2px);
      }
    
      /* Export Section */
      .export-section {
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        padding: 20px;
        margin-top: 24px;
      }
    
      .export-section h4 {
        color: #333;
        text-align: center;
        margin-bottom: 16px;
      }
    
      #view-export-form {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px 32px;
        align-items: start;
        margin-bottom: 16px;
      }
    
      #view-export-form .export-pair {
        display: flex;
        align-items: center;
        gap: 10px;
      }
    
      #view-export-form .export-label {
        font-weight: 500;
        color: #555;
        min-width: 80px;
        flex-shrink: 0;
      }
    
      .export-input {
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 5px;
        box-sizing: border-box;
      }
    
      .export-select {
        width: 100%;
        min-width: 120px;
        max-width: 180px;
        height: 40px;
        padding: 8px 12px;
        font-size: 16px;
        border-radius: 5px;
        border: 1px solid #ddd;
        background: #f8f9fa;
      }
    
      .export-number {
        width: 100px;
      }
    
      #view-export-form .export-btn-group {
        grid-column: 1 / -1;
        display: flex;
        justify-content: center;
        margin-top: 16px;
      }
    
      #view-export-form .export-btn {
        background: linear-gradient(90deg, #1976d2 0%, #1565c0 100%);
        color: white;
        padding: 12px 20px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        min-width: 140px;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }
    
      #view-export-form .export-btn:hover {
        box-shadow: 0 4px 12px rgba(25, 118, 210, 0.3);
        transform: translateY(-2px);
      }
    
      #view-export-msg {
        text-align: center;
        color: #388e3c;
        font-weight: bold;
        margin-top: 8px;
      }

      /* Export Download Link Style */
      .export-download-link {
        display: inline-block;
        background: linear-gradient(90deg, #17a2b8 0%, #138496 100%);
        color: white;
        padding: 12px 20px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        text-decoration: none;
        cursor: pointer;
        transition: all 0.2s;
        box-shadow: 0 2px 8px rgba(23,162,184,0.2);
        margin-top: 8px;
      }

      .export-download-link:hover {
        background: linear-gradient(90deg, #138496 0%, #117a8b 100%);
        box-shadow: 0 4px 12px rgba(23,162,184,0.3);
        transform: translateY(-2px);
        color: white;
        text-decoration: none;
      }
    
      /* Responsive Adjustments */
      @media (max-width: 600px) {
        #view-mode-row {
          flex-direction: column;
          gap: 24px;
        }
    
        #view-export-form {
          grid-template-columns: 1fr;
          gap: 16px;
        }
    
        #view-export-form .export-pair {
          flex-direction: column;
          align-items: stretch;
          text-align: left;
        }
    
        #view-svg-actions {
          flex-direction: column;
          gap: 10px;
        }
    
        #view-svg-actions .view-action-btn,
        #view-export-form .export-btn {
          width: 100%;
          max-width: 100%;
          box-sizing: border-box;
        }
    
        #view-back-to-edit-btn {
          width: 100%;
        }
    
        .profile-navbar {
          flex-direction: column;
          align-items: stretch;
          gap: 10px;
          margin-bottom: 16px;
        }
    
        .profile-navbar > div {
          width: 100%;
          display: flex;
          flex-wrap: wrap;
          gap: 8px;
          justify-content: center;
        }
    
        .profile-navbar a,
        .profile-navbar button {
          flex: 1 1 auto;
          width: 100%;
          text-align: center;
          font-size: 16px;
          padding: 12px 0;
          box-sizing: border-box;
        }
      }

      /* Tablet Layout (601px - 1040px) */
      @media (min-width: 601px) and (max-width: 1040px) {
  #view-mode-row {
    display: flex;
    flex-wrap: nowrap;
    gap: 24px;
  }

  .view-col:first-child {
    flex: 1 1 auto;
    min-width: 300px;
  }

      .view-col:last-child {
      flex: 0 0 330px;
      max-width: 330px;
    }
    
    /* Tablet: Form export 1 c·ªôt v·ªõi c√°c c·∫∑p inline */
    #view-export-form {
      grid-template-columns: 1fr;
      gap: 12px;
    }

    #view-export-form .export-pair {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-direction: row;
    }

    #view-export-form .export-label {
      min-width: 70px;
      flex-shrink: 0;
    }

    #view-export-form .export-select {
      flex: 1;
      min-width: 120px;
    }

    #view-export-form .export-number {
      flex: 1;
      min-width: 80px;
    }

    #view-export-form .export-btn-group {
      grid-column: 1 / -1;
      justify-content: center;
      margin-top: 16px;
    }
  }

      /* Khi m√†n h√¨nh l·ªõn h∆°n 600px - hi·ªÉn th·ªã inline ƒë·∫πp h∆°n */
      @media (min-width: 601px) {
        .profile-navbar {
          flex-wrap: nowrap;
          padding: 8px 16px;
        }

        .profile-navbar-left,
        .profile-navbar-right {
          display: flex;
          align-items: center;
          gap: 12px;
        }

        .profile-navbar a,
        .profile-navbar button {
          width: auto;
          padding: 8px 16px;
          font-size: 14px;
          flex: none;
        }

        .navbar-user-info {
          display: flex;
          align-items: center;
          gap: 8px;
          padding: 6px 12px;
          border-radius: 6px;
          background: linear-gradient(135deg, #1976d2, #1565c0);
          color: white;
          text-decoration: none;
          box-shadow: 0 2px 6px rgba(25, 118, 210, 0.1);
          transition: all 0.2s;
        }

        .navbar-user-info:hover {
          background: linear-gradient(135deg, #1565c0, #0d47a1);
        }

        .navbar-avatar {
          width: 28px;
          height: 28px;
          border-radius: 50%;
          object-fit: cover;
          border: 2px solid #fff;
        }

        .navbar-username {
          font-weight: 500;
          font-size: 14px;
          white-space: nowrap;
        }
      }
    </style>
</head>
<body>
  <div class="profile-navbar">
    <div class="profile-navbar-left">
      <a href="/" class="btn btn-secondary navbar-btn">
        üè† V·ªÅ trang ch·ªß
      </a>
      <button type="button" id="dark-mode-toggle" class="btn btn-secondary navbar-btn">
        üåô Dark Mode
      </button>
    </div>
    <div class="profile-navbar-right">
      {% if user_email %}
        <a href="/profile" class="navbar-user-info">
          <img src="{{ url_for('static', filename='avatars/' ~ avatar) if avatar else '' }}"
               alt="Avatar" class="navbar-avatar"
               onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
          {% if not avatar %}
          <div class="navbar-avatar-placeholder">
            {{ user_email[0].upper() }}
          </div>
          {% endif %}
          <span class="navbar-username">
            {{ username or user_email.split('@')[0] }}
          </span>
        </a>
        <a id="logout-btn" href="#" class="btn logout-btn navbar-btn">
          ƒêƒÉng xu·∫•t
        </a>
      {% else %}
        <a id="user-email-btn" href="/login/google" class="btn btn-secondary navbar-btn">
          ƒêƒÉng nh·∫≠p Google
        </a>
      {% endif %}
    </div>
  </div>
    <div class="container">
        <h2>{{ display_name }}</h2>
        <div id="view-mode-row">
            <div class="view-col">
                <div id="view-svg-preview">
                    <img id="view-svg-img" src="{{ svg_url }}" alt="SVG Preview">
                </div>
                <div id="view-svg-actions">
                    <button id="view-copy-link-btn" class="view-action-btn">üîó Copy Link</button>
                    <button id="view-download-svg-btn" class="view-action-btn view-download-btn">üì• T·∫£i xu·ªëng SVG</button>
                </div>
            </div>
            <div class="view-col">
                <div style="margin-bottom:20px;">
                    <h4 style="color:#333; margin-bottom:15px;">C√°c thao t√°c</h4>
                    <div style="display:flex; flex-direction:column; gap:10px;">
                        <button id="view-back-to-edit-btn">‚Ü©Ô∏è Quay v·ªÅ ch·ªânh s·ª≠a code TikZ</button>
                    </div>
                </div>
                <div id="view-export-section">
                    <div class="export-section">
                        <h4>Xu·∫•t ·∫£nh PNG/JPEG</h4>
                        <form id="view-export-form" class="export-form">
                            <div class="export-pair">
                                <label for="view-export-format" class="export-label">ƒê·ªãnh d·∫°ng:</label>
                                <select id="view-export-format" class="export-input export-select">
                                    <option value="png">PNG</option>
                                    <option value="jpeg">JPEG</option>
                                </select>
                            </div>
                            <div class="export-pair">
                                <label for="view-export-dpi" class="export-label">DPI:</label>
                                <input type="number" id="view-export-dpi" min="1" class="export-input export-number" placeholder="Auto">
                            </div>
                            <div class="export-pair">
                                <label for="view-export-width" class="export-label">Width (px):</label>
                                <input type="number" id="view-export-width" min="1" class="export-input export-number" placeholder="Auto">
                            </div>
                            <div class="export-pair">
                                <label for="view-export-height" class="export-label">Height (px):</label>
                                <input type="number" id="view-export-height" min="1" class="export-input export-number" placeholder="Auto">
                            </div>
                            <div class="export-btn-group">
                                <button id="view-export-btn" type="button" class="export-btn">T·∫£i xu·ªëng</button>
                            </div>
                        </form>
                        <div id="view-export-msg" class="export-msg"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal ƒëƒÉng xu·∫•t ch·ªâ render n·∫øu ƒë√£ login -->
    {% if user_email %}
    <div id="logout-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.3); z-index:9999; align-items:center; justify-content:center;">
      <div style="background:white; padding:32px 40px; border-radius:12px; box-shadow:0 2px 16px rgba(0,0,0,0.15); min-width:320px; text-align:center;">
        <h3 style="margin-bottom:24px;">ƒêƒÉng xu·∫•t?</h3>
        <a href="/logout" style="display:inline-block; background:#d32f2f; color:white; padding:10px 28px; border-radius:6px; text-decoration:none; font-weight:bold;">ƒêƒÉng xu·∫•t</a>
        <button onclick="document.getElementById('logout-modal').style.display='none'" style="margin-left:18px; background:#eee; color:#333; padding:10px 28px; border-radius:6px; border:none; font-weight:bold;">Hu·ª∑</button>
      </div>
    </div>
    {% endif %}

    <!-- Modal ƒëƒÉng nh·∫≠p -->
    <div id="login-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.3); z-index:9999; align-items:center; justify-content:center;">
      <div style="background:white; padding:32px 40px; border-radius:12px; box-shadow:0 2px 16px rgba(0,0,0,0.15); min-width:320px; text-align:center;">
        <h3 style="margin-bottom:24px;">ƒêƒÉng nh·∫≠p ƒë·ªÉ ti·∫øp t·ª•c</h3>
        <p style="margin-bottom:24px; color:#666;">B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ s·ª≠ d·ª•ng t√≠nh nƒÉng n√†y.</p>
        <a href="/login/google" style="display:inline-block; background:#1976d2; color:white; padding:12px 24px; border-radius:6px; text-decoration:none; font-weight:bold;">ƒêƒÉng nh·∫≠p Google</a>
        <button onclick="document.getElementById('login-modal').style.display='none'" style="margin-left:18px; background:#eee; color:#333; padding:12px 24px; border-radius:6px; border:none; font-weight:bold;">Hu·ª∑</button>
      </div>
    </div>

    <!-- JavaScript cho header -->
    <script>
    // Tr·∫°ng th√°i ƒëƒÉng nh·∫≠p t·ª´ server
    const isLoggedIn = {{ 'true' if user_email else 'false' }};
    
    // H√†m hi·ªÉn th·ªã modal ƒëƒÉng nh·∫≠p
    function showLoginModal() {
        document.getElementById('login-modal').style.display = 'flex';
    }
    
    // H√†m ki·ªÉm tra ƒëƒÉng nh·∫≠p tr∆∞·ªõc khi th·ª±c hi·ªán ch·ª©c nƒÉng
    function requireLogin(callback) {
        if (isLoggedIn) {
            callback();
        } else {
            showLoginModal();
        }
    }
    
    // H√†m copy to clipboard
    function copyToClipboard(text, button, originalText) {
        if (navigator.clipboard && window.isSecureContext) {
            navigator.clipboard.writeText(text).then(() => {
                button.textContent = '‚úÖ ƒê√£ copy!';
                setTimeout(() => {
                    button.textContent = originalText;
                }, 2000);
            });
        } else {
            // Fallback cho c√°c tr√¨nh duy·ªát c≈©
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.opacity = 0;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            
            button.textContent = '‚úÖ ƒê√£ copy!';
            setTimeout(() => {
                button.textContent = originalText;
            }, 2000);
        }
    }
    
    // H√†m x·ª≠ l√Ω export PNG/JPEG
    async function handleExport() {
        const format = document.getElementById('view-export-format').value;
        const widthVal = document.getElementById('view-export-width').value;
        const heightVal = document.getElementById('view-export-height').value;
        const dpiVal = document.getElementById('view-export-dpi').value;
        const msg = document.getElementById('view-export-msg');
        const exportBtn = document.getElementById('view-export-btn');
        
        msg.textContent = '';
        
        if ((widthVal && widthVal <= 0) || (heightVal && heightVal <= 0) || (dpiVal && dpiVal <= 0)) {
            msg.textContent = 'Width, Height, DPI ph·∫£i l√† s·ªë d∆∞∆°ng!';
            return;
        }
        
        exportBtn.disabled = true;
        exportBtn.textContent = 'ƒêang x·ª≠ l√Ω...';
        
        try {
            // L·∫•y filename t·ª´ URL
            const filename = window.location.pathname.split('/').pop();
            
            const res = await fetch('/convert', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    filename: filename,
                    fmt: format,
                    width: widthVal || undefined,
                    height: heightVal || undefined,
                    dpi: dpiVal || undefined
                })
            });
            
            const data = await res.json();
            if (data.url) {
                msg.innerHTML = `<a href="${data.url}" download class="export-download-link">T·∫£i v·ªÅ ${format.toUpperCase()}</a>`;
            } else {
                msg.textContent = data.error || 'L·ªói kh√¥ng x√°c ƒë·ªãnh!';
            }
        } catch (err) {
            msg.textContent = 'L·ªói k·∫øt n·ªëi ho·∫∑c m√°y ch·ªß!';
        }
        
        exportBtn.disabled = false;
        exportBtn.textContent = 'T·∫£i xu·ªëng';
    }
    
    document.addEventListener('DOMContentLoaded', function() {
        // G√°n s·ª± ki·ªán cho n√∫t ƒëƒÉng xu·∫•t
        const logoutBtn = document.getElementById('logout-btn');
        if (logoutBtn) {
            logoutBtn.onclick = () => document.getElementById('logout-modal').style.display = 'flex';
        }
        
        // G√°n s·ª± ki·ªán cho n√∫t ƒëƒÉng nh·∫≠p
        const loginBtn = document.getElementById('user-email-btn');
        if (loginBtn) {
            loginBtn.href = "/login/google";
        }

        // G√°n s·ª± ki·ªán cho n√∫t Copy Link
        const copyLinkBtn = document.getElementById('view-copy-link-btn');
        if (copyLinkBtn) {
            copyLinkBtn.onclick = function() {
                requireLogin(() => {
                    // L·∫•y URL c·ªßa file SVG trong /static v√† th√™m t√™n mi·ªÅn
                    const svgPath = '{{ svg_url }}';
                    const baseUrl = window.location.origin;
                    const fullSvgUrl = baseUrl + svgPath;
                    copyToClipboard(fullSvgUrl, this, 'üîó Copy Link');
                });
            };
        }

        // G√°n s·ª± ki·ªán cho n√∫t Download SVG
        const downloadSvgBtn = document.getElementById('view-download-svg-btn');
        if (downloadSvgBtn) {
            downloadSvgBtn.onclick = function() {
                requireLogin(() => {
                    // T·∫°o link t·∫°m th·ªùi ƒë·ªÉ download
                    const svgUrl = '{{ svg_url }}';
                    const link = document.createElement('a');
                    link.href = svgUrl;
                    link.download = '';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                });
            };
        }

        // G√°n s·ª± ki·ªán cho n√∫t "‚Ü©Ô∏è Quay v·ªÅ ch·ªânh s·ª≠a code TikZ"
        const backToEditBtn = document.getElementById('view-back-to-edit-btn');
        if (backToEditBtn) {
            backToEditBtn.onclick = function() {
                requireLogin(() => {
                    // L·∫•y code TikZ ƒë√£ l∆∞u (gi·ªëng logic trang ch·ªß)
                    let currentCode = window.currentViewTikzCode || 
                                    localStorage.getItem('tikz_code_for_edit') || 
                                    '{{ tikz_code|default("")|tojson|safe }}';
                    
                    // Lo·∫°i b·ªè d·∫•u ngo·∫∑c k√©p th·ª´a n·∫øu c√≥
                    if (currentCode && currentCode.startsWith('"') && currentCode.endsWith('"')) {
                        currentCode = currentCode.slice(1, -1);
                    }
                    
                    // Unescape c√°c k√Ω t·ª± ƒë·∫∑c bi·ªát
                    if (currentCode) {
                        currentCode = currentCode.replace(/\\n/g, '\n')
                                               .replace(/\\t/g, '\t')
                                               .replace(/\\"/g, '"')
                                               .replace(/\\\\/g, '\\');
                    }
                    
                    // L∆∞u code v√†o localStorage ƒë·ªÉ trang ch·ªß c√≥ th·ªÉ ƒë·ªçc
                    localStorage.setItem('tikz_code_for_compile', currentCode);
                    
                    // Chuy·ªÉn v·ªÅ trang ch·ªß
                    window.location.href = '/';
                });
            };
        }

        // G√°n s·ª± ki·ªán cho n√∫t T·∫£i xu·ªëng PNG/JPEG
        const exportBtn = document.getElementById('view-export-btn');
        if (exportBtn) {
            exportBtn.onclick = function() {
                requireLogin(function() {
                    handleExport();
                });
            };
        }
        
        // X·ª≠ l√Ω sau khi ƒëƒÉng nh·∫≠p th√†nh c√¥ng
        if (window.location.search.includes('login=1')) {
            // Reload trang ƒë·ªÉ c·∫≠p nh·∫≠t tr·∫°ng th√°i ƒëƒÉng nh·∫≠p
            window.location.href = window.location.pathname;
        }
    });
    </script>

    <!-- Highlight.js JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/latex.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
    <script>
        // Initialize highlight.js
        document.addEventListener('DOMContentLoaded', function() {
            hljs.highlightAll();
            hljs.initLineNumbersOnLoad();
        });
    </script>
    <footer style='text-align:center;color:#888;font-size:14px;margin-top:40px;'>¬© 2024 TikZ2SVG - All rights reserved.</footer>
</body>
</html> 